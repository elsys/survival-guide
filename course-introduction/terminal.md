# Terminal

---

> "On a UNIX system, everything is a file; if something is not a file, it is a process."

За успешното и по-лесно завършване на курса по програмиране е силно препоръчително учениците да познават и да могат да работят с терминал. Поради спецификата на предмета конзолата ще бъде често използвана за ралзични задачи и цели. Огромна част от програмите, които се пишат в час и за домашно, нямат потребителски интерфейс. Итеракцията с тях става чрез терминала. В него се пишат команди, които представят в голяма част от случаите програми, които правят някакво действие. Тези команди приемат аргументи и връщат някакъв резултат.

Първата команда, която ще да демонстрираме, е командата `man`.

## man

Идва от **manual **и като аргумент приема името на командата чието ръководството искате да видите. Какъв по-добър пример от това да се опитаме да видим ръководството на командата man.

```bash
$ man man
```

![](/assets/Screen Shot 2016-09-21 at 20.07.34.png)

> За да излезете от man натиснете q \(от quit\) на клавиатурата.

## Навигация

По подразбиране когато отворим терминала той ни позиционира в основната папката на потребителя. За да се уверим къде из файловото дърво се намираме използваме командата pwd.

### pwd

**Print Working Directory** е команда с която можем да разберем къде се намираме в системата. Тя трябва да изведе нещо името папката:

```bash
$ pwd
/home/johndoe
```

След като вече имаме яснота къде сме е време да започнем и да се 'разхождаме' по папките. За целта ще използваме командата cd.

### cd

cd идва от **Change Directory** и като почти всяка команда в конзолата е програма, която приема аргументи. Например ако напишем

```bash
$ cd ~
```

ще се върнем в папката на потребителя. Важно е да се уточни, че има две специални 'папки' които трябва да знаем. Това са `.` и `..`  където

* `.` представлява текущата директория, в която се намираме. Тази точка ще ни бъде полезно за да изпълняваме програми от текущата папка по-напред.
* `..` представлява предишната директория, тази в която се намира текущата.

Пример:

```bash
$ pwd
/home/johndoe
$ cd Downloads
$ pwd
/home/johndoe/Downloads
$ cd ../Pictures
$ pwd
/home/johndoe/Pictures
$ cd ..
```

### ls

**LiSt directory** - използваме я, когато искаме да видим какво има в дадена папка. `ls` приема като аргумент папката на която искаме да видим съдържанието.

```bash
$ ls
Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos
$ ls Downloads
bitcoin.pdf  gitbook-editor-7.0.12-linux-ia32.deb  ramsmp-3.5.0  ramsmp-3.5.0.tar.gz
```

Освен аргумент за папка, можем да подаваме аргументи от тип "флагове". Това са аргументи, които започват с тире или две тирета и променят по някакъв начин поведението на програмата.

```bash
$ ls -l Downloads
total 42852
-rw-r--r-- 1 root root   184292 Sep 23 23:11 bitcoin.pdf
-rw-r--r-- 1 root root 43606314 Sep 23 23:11 gitbook-editor-7.0.12-linux-ia32.deb
drwxr-xr-x 6 root root     4096 Sep 23 23:17 ramsmp-3.5.0
-rw-r--r-- 1 root root    79481 Sep 23 23:17 ramsmp-3.5.0.tar.gz
```

```bash
$ ls -la Downloads
total 42860
drwxr-xr-x  3 johndoe johndoe     4096 Sep 25 16:52 .
drwxr-xr-x 16 johndoe johndoe     4096 Sep 25 16:48 ..
-rw-r--r--  1 root    root      184292 Sep 23 23:11 bitcoin.pdf
-rw-r--r--  1 root    root    43606314 Sep 23 23:11 gitbook-editor-7.0.12-linux-ia32.deb
drwxr-xr-x  6 root    root        4096 Sep 23 23:17 ramsmp-3.5.0
-rw-r--r--  1 root    root       79481 Sep 23 23:17 ramsmp-3.5.0.tar.gz
```

## Операции с файлове и папки

Вече показахме как се навигира по папаките във файловата система, как да разберем къде се намираме и по какъв начин да видим всички файлове в дадена директория. Идва моментът, в който се налага да започнем да работим с тези файлове – да създаваме нови, да трием, да местим.

Може би сте забелязали, че имената на повечето команди са съкращение от това, което правят. Затова едва ли ще се изненадате какво правят командите `mv`, `cp` и `rm`.

### mv

> премества файлове и\или директории от едно място на друго

Приема два аргумента - source и destination, които могат да бъдат файл или папка. За преименуване на файлове или папки отново се използва тази команда.

Пример за преименуване:

```bash
$ ls
Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos
$ mv Documents Документи
$ ls
Desktop  Документи  Downloads  Music  Pictures  Public  Templates  Videos
```

Пример за преместване:

```bash
$ pwd
/home/johndoe/Downloads
$ ls
bitcoin.pdf  gitbook-editor-7.0.12-linux-ia32.deb  ramsmp-3.5.0  ramsmp-3.5.0.tar.gz
$ mv ramspm-3.5.0 ../Desktop # moves the ramspm-3.5.0 folder inside the Desktop folder
$ ls ../Desktop
ramsmp-3.5.0
```

### cp

> копира файлове и\или директории от едно място на друго

Работи на същият принцип като `mv`, но запазва оригиналното копие непроменено.

### rm

> изтрива даден файл или от файлове и папки

При изтриване на папки и цялото им съдържание е необходимо да се използва флагът `-r`. Друг често използван флаг е `-f`,  който кара командата да не пита за потвърждение при триене на множество от файлове и папки.

### Други команди

Други команди в терминала, свързани с манипулация на файлове и папки са:

* `rmdir`
* `chmod` и `chown`

Опитайте се да разберете какви функции изпълняват тези команди използвайки `man`.

## Обработка на файлове

Linux средата предоставя множество команди, които са предназначени за работа с файлове. Нека започнем с най-важното – редактирането на един файл.

### vim

![](/assets/vim.png)

Редакторът vim \(**Vi IMproved**\) идва с почти всяка дистрибуция на Linux. Той е безплатен редактор, предназначен за употреба в терминала, като се различава от повечето текстови редактори с това, че има различни "режими", един от които е този за писане, стандартен за повечето текстови редактори.

Когато напишете `vim` в терминала ви посреща основният екран с няколко упътващи реда.

![](/assets/vim-greeting.png)

> За да излезнете от vim, без да запазите промените си, натиснете `<Escape>:q<Enter>`.

За влизане в режимът на писане използвайте клавишът  `i`, от **Insert** mode, след което можете да въвеждате символи от клавиатурата. За да излезете от Insert mode натиснете `<Escape>`.

За запазване на промените си във файл, наречен `file.txt`, напишете `:w file.txt`. Следващия записвания могат да се изпълняват само чрез `:w`, защото Vim ще запомни името на текущия файл, който редактирате

За да отворите за редактиране вече създаден файл използвайте `vim file.c`.

По-подробно описание за изолзването на vim можете да намерите [тук](https://danielmiessler.com/study/vim/).

### cat

Командара `cat` принтира съдържанието на всичките файлове, подадени като аргументи на програмата, в реда, в който са подадени. Името й идва не от животното котка, а от операцията конкатенация[^1].

```bash
$ cat FL_insurance_sample.csv
policyID,statecode,county,eq_site_limit,hu_site_limit,fl_site_limit,fr_site_limit,tiv_2011,tiv_2012,eq_site_deductible,hu_site_deductible,fl_site_deductible,fr_site_deductible,point_latitude,point_longitude,line,construction,point_granularity
119736,FL,CLAY COUNTY,498960,498960,498960,498960,498960,792148.9,0,9979.2,0,0,30.102261,-81.711777,Residential,Masonry,1
448094,FL,CLAY COUNTY,1322376.3,1322376.3,1322376.3,1322376.3,1322376.3,1438163.57,0,0,0,0,30.063936,-81.707664,Residential,Masonry,3
206893,FL,CLAY COUNTY,190724.4,190724.4,190724.4,190724.4,190724.4,192476.78,0,0,0,0,30.089579,-81.700455,Residential,Wood,1

# trimmed
```

### head и tail

Командите `head` и `tail` помагат за разглеждането на части от файлове, като `head` показва първите 10 реда, а `tail` - последните 10. Те са изключително полезни при работа с големи файлове.

```bash
$ ls -lah FL_insurance_sample.csv
-rw-r--rw- 1 johndoe johndoe 4.0M Sep 25 17:54 FL_insurance_sample.csv
                             ^- # the file is 4MB big, in human readable form

$ cat FL_insurance_sample.csv <ctrl+c># this is not very wise to do.. we can't see the header of the file
$ head FL_insurance_sample.csv
policyID,statecode,county,eq_site_limit,hu_site_limit,fl_site_limit,fr_site_limit,tiv_2011,tiv_2012,eq_site_deductible,hu_site_deductible,fl_site_deductible,fr_site_deductible,point_latitude,point_longitude,line,construction,point_granularity
119736,FL,CLAY COUNTY,498960,498960,498960,498960,498960,792148.9,0,9979.2,0,0,30.102261,-81.711777,Residential,Masonry,1
448094,FL,CLAY COUNTY,1322376.3,1322376.3,1322376.3,1322376.3,1322376.3,1438163.57,0,0,0,0,30.063936,-81.707664,Residential,Masonry,3
206893,FL,CLAY COUNTY,190724.4,190724.4,190724.4,190724.4,190724.4,192476.78,0,0,0,0,30.089579,-81.700455,Residential,Wood,1
333743,FL,CLAY COUNTY,0,79520.76,0,0,79520.76,86854.48,0,0,0,0,30.063236,-81.707703,Residential,Wood,3
172534,FL,CLAY COUNTY,0,254281.5,0,254281.5,254281.5,246144.49,0,0,0,0,30.060614,-81.702675,Residential,Wood,1
785275,FL,CLAY COUNTY,0,515035.62,0,0,515035.62,884419.17,0,0,0,0,30.063236,-81.707703,Residential,Masonry,3
995932,FL,CLAY COUNTY,0,19260000,0,0,19260000,20610000,0,0,0,0,30.102226,-81.713882,Commercial,Reinforced Concrete,1
223488,FL,CLAY COUNTY,328500,328500,328500,328500,328500,348374.25,0,16425,0,0,30.102217,-81.707146,Residential,Wood,1
433512,FL,CLAY COUNTY,315000,315000,315000,315000,315000,265821.57,0,15750,0,0,30.118774,-81.704613,Residential,Wood,1

$ tail FL_insurance_sample.csv
827844,FL,PINELLAS COUNTY,0,38112.3,0,38112.3,38112.3,52710.45,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
876385,FL,PINELLAS COUNTY,0,18312.3,0,18312.3,18312.3,18575.81,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
167630,FL,PINELLAS COUNTY,0,4522.5,0,4522.5,4522.5,4048.11,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
241496,FL,PINELLAS COUNTY,0,1350,0,1350,1350,1430.16,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
780814,FL,PINELLAS COUNTY,0,9770.4,0,9770.4,9770.4,9349.98,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
404309,FL,PINELLAS COUNTY,0,88722,0,88722,88722,155065.65,0,0,0,0,28.122885,-82.770218,Residential,Wood,3
465875,FL,PINELLAS COUNTY,1297057.5,1297057.5,1297057.5,1297057.5,1297057.5,1577500.79,0,0,0,0,28.0809,-82.7588,Residential,Masonry,1
791209,FL,PINELLAS COUNTY,173286.9,173286.9,0,0,173286.9,205527.97,0,0,0,0,28.11055,-82.76636,Residential,Wood,4
322627,FL,PINELLAS COUNTY,1499781.6,1499781.6,0,0,1499781.6,1768782.43,0,0,0,0,28.089415,-82.697411,Residential,Masonry,3
398149,FL,PINELLAS COUNTY,373488.3,373488.3,0,0,373488.3,596003.67,0,0,0,0,28.06444,-82.77459,Residential,Masonry,1
```

### less

Командата `less` ни позволява да разгледаме целия файл, но за разлика от `cat` не просто принтира цялото съдържание на екрана, а позволява да се навигира из файла използвайки PageUp/PageDown, както и да се търси чрез `/`.

![](/assets/less.png)

> Излизането от less става чрез натискане на `q`.

## Компилация

За компилиране на нашите файлове код ще използваме компилаторът `gcc`.

Компилацията е процес, при който сорс кодът на програмата се превежда до машинен код. Резултатният файл от компилацията е изпълним и чрез него може да бъде пусната програмата.

### Здравей, свят

Ако се опитаме да компилираме следният C файл.

```c
#include <stdio.h>

int main() {
    printf("Hello, world!\n");
    return 0;
}
```

```
$ gcc file.c
$ ls
a.out  file.c
```

Новосъздаденият файл `a.out` може да бъде пуснат чрез `./a.out`.

```
$ ./a.out
Hello, world
```

### Компилационни грешки и предупреждения

Ако програмата има грешки или компилаторът намери слабости в нея, то при `gcc file.c` ще получим описателен текст какъкв е проблемът. Ако например забравим да напишем `include` в горният пример ще получим следния изход от компилатора:

```
$ gcc file.c
file.c: In function ‘main’:
file.c:2:2: warning: implicit declaration of function ‘printf’ [-Wimplicit-function-declaration]
  printf("Hello, world!");
  ^~~~~~
file.c:2:2: warning: incompatible implicit declaration of built-in function ‘printf’
file.c:2:2: note: include ‘<stdio.h>’ or provide a declaration of ‘printf’
```

В случая получаваме само предупреждение, че не сме добавили декларация за функцията `printf`. 

Възможно е да получим и грешка, нека се опитаме да компилираме този код:

```c
#include <stdio.h>

int main() {
    printf("Hello, world\n");
    return 0;
// missing closing bracket
```

```
$ gcc file.c
file.c: In function ‘main’:
file.c:5:2: error: expected declaration or statement at end of input
  return 0;
  ^~~~~~
```

При дори и един error не се продуцира `a.out` изпълним файл. Ако имате такъв файл, то той е от предишната компилация.

### Стандартизирано компилиране

За да се компилират еднакво нашите програми с еднакви грешки и предупредителни съобщения ще използваме редица аргументи към `gcc`, които подсигуряват строгото спазване на стандарта C11[^1] без никакви добавки и включени повечето видове предупреждения.

```bash
$ gcc -Wall -pedantic -std=c11 file.c
```

## Полезни линкове

* [Learnshell.org](http://www.learnshell.org/)

* [Explainshell.com](http://explainshell.com/)

* [The art of command line](https://github.com/jlevy/the-art-of-command-line)



[^1]: [https://en.wikipedia.org/wiki/C11\_\(C\_standard\_revision\)](https://en.wikipedia.org/wiki/C11_%28C_standard_revision%29)

